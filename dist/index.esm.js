import*as t from"@turf/turf";import n,{useState as e,useRef as r,useCallback as i,useEffect as o,useMemo as a,memo as c}from"react";var u=function(){return u=Object.assign||function(t){for(var n,e=1,r=arguments.length;e<r;e++)for(var i in n=arguments[e])Object.prototype.hasOwnProperty.call(n,i)&&(t[i]=n[i]);return t},u.apply(this,arguments)};function l(t,n,e,r){return new(e||(e=Promise))((function(i,o){function a(t){try{u(r.next(t))}catch(t){o(t)}}function c(t){try{u(r.throw(t))}catch(t){o(t)}}function u(t){var n;t.done?i(t.value):(n=t.value,n instanceof e?n:new e((function(t){t(n)}))).then(a,c)}u((r=r.apply(t,n||[])).next())}))}function f(t,n){var e,r,i,o={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]},a=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return a.next=c(0),a.throw=c(1),a.return=c(2),"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function c(c){return function(u){return function(c){if(e)throw new TypeError("Generator is already executing.");for(;a&&(a=0,c[0]&&(o=0)),o;)try{if(e=1,r&&(i=2&c[0]?r.return:c[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,c[1])).done)return i;switch(r=0,i&&(c=[2&c[0],i.value]),c[0]){case 0:case 1:i=c;break;case 4:return o.label++,{value:c[1],done:!1};case 5:o.label++,r=c[1],c=[0];continue;case 7:c=o.ops.pop(),o.trys.pop();continue;default:if(!(i=o.trys,(i=i.length>0&&i[i.length-1])||6!==c[0]&&2!==c[0])){o=0;continue}if(3===c[0]&&(!i||c[1]>i[0]&&c[1]<i[3])){o.label=c[1];break}if(6===c[0]&&o.label<i[1]){o.label=i[1],i=c;break}if(i&&o.label<i[2]){o.label=i[2],o.ops.push(c);break}i[2]&&o.ops.pop(),o.trys.pop();continue}c=n.call(t,o)}catch(t){c=[6,t],r=0}finally{e=i=0}if(5&c[0])throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}([c,u])}}}"function"==typeof SuppressedError&&SuppressedError;var s=function(t){var n;return t?"MultiPolygon"===t.type?{type:"Polygon",coordinates:t.coordinates.flat(1)}:"Feature"===t.type&&"MultiPolygon"===(null===(n=t.geometry)||void 0===n?void 0:n.type)?u(u({},t),{geometry:{type:"Polygon",coordinates:t.geometry.coordinates.flat(1)}}):t:null},p=function(n,e){return void 0===e&&(e=.001),n?t.simplify(n,{tolerance:e,highQuality:!1}):null},y=function(n){if(!n||0===n.length)return null;if(1===n.length)return n[0];try{for(var e=n.map((function(n){return"Feature"===n.type?n:t.feature(n)})),r=(t.featureCollection(e),e[0]),i=1;i<e.length;i++)r=t.union(r,e[i]);return r}catch(t){return console.error("Error merging polygons:",t),n[0]}},d=function(n){return n?t.area(n):0},v=function(n,e){if(!n||!e)return!1;var r=t.point(n);return t.booleanPointInPolygon(r,e)},h=function(t,n){if(void 0===n&&(n={}),!t)return null;var e=n.simplify,r=void 0===e||e,i=n.simplifyTolerance,o=void 0===i?.001:i,a=n.flatten,c=t;return(void 0===a||a)&&(c=s(c)),r&&(c=p(c,o)),c},m=function(){function t(t){void 0===t&&(t=100),this.capacity=t,this.cache=new Map}return t.prototype.get=function(t){if(this.cache.has(t)){var n=this.cache.get(t);return this.cache.delete(t),this.cache.set(t,n),n}},t.prototype.set=function(t,n){if(this.cache.has(t))this.cache.delete(t);else if(this.cache.size>=this.capacity){var e=this.cache.keys().next().value;void 0!==e&&this.cache.delete(e)}this.cache.set(t,n)},t.prototype.delete=function(t){return this.cache.delete(t)},t.prototype.clear=function(){this.cache.clear()},t.prototype.size=function(){return this.cache.size},t.prototype.keys=function(){return Array.from(this.cache.keys())},t}();function g(t,n,e){void 0===n&&(n=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];return JSON.stringify(t)}),void 0===e&&(e={});var r=new m(e.capacity||100);return function(){for(var e=[],i=0;i<arguments.length;i++)e[i]=arguments[i];var o=n.apply(void 0,e),a=r.get(o);if(void 0!==a)return a;var c=t.apply(void 0,e);return r.set(o,c),c}}function b(t,n){var a=this;void 0===n&&(n={});var c=n.flatten,u=void 0===c||c,s=n.simplify,p=void 0===s||s,y=n.simplifyTolerance,d=void 0===y?.001:y,v=n.pollingInterval,m=void 0===v?0:v,b=n.autoOptimize,w=void 0===b||b,S=e(null),O=S[0],N=S[1],T=e(!0),E=T[0],P=T[1],k=e(null),z=k[0],J=k[1],x=r(g((function(t){return h(t,{simplify:p,simplifyTolerance:d,flatten:u})}),(function(t){return JSON.stringify({id:t.id||Math.random().toString(36).substring(2,9),lastModified:t.lastModified||Date.now()})}),{capacity:20})).current,I=i((function(){return l(a,void 0,void 0,(function(){var n,e,r,i;return f(this,(function(o){switch(o.label){case 0:return o.trys.push([0,3,,4]),P(!0),J(null),[4,fetch(t)];case 1:if(!(n=o.sent()).ok)throw new Error("HTTP error! Status: ".concat(n.status));return[4,n.json()];case 2:return e=o.sent(),r=w?x(e):e,N(r),P(!1),[3,4];case 3:return i=o.sent(),J(i instanceof Error?i:new Error(String(i))),P(!1),[3,4];case 4:return[2]}}))}))}),[t,w,x]);o((function(){var t;return I(),m>0&&(t=setInterval(I,m)),function(){t&&clearInterval(t)}}),[I,m]);var M=i((function(){return l(a,void 0,void 0,(function(){return f(this,(function(t){switch(t.label){case 0:return[4,I()];case 1:return t.sent(),[2]}}))}))}),[I]);return{data:O,loading:E,error:z,refresh:M}}function w(t){void 0===t&&(t={});var n=t.defaultSimplifyTolerance,e=void 0===n?.001:n,r=t.useMemoization,o=void 0===r||r,c=t.cacheSize,u=void 0===c?50:c,l=a((function(){return o?g(p,(function(t,n){return"".concat(JSON.stringify(t),"-").concat(n)}),{capacity:u}):p}),[o,u]),f=a((function(){return o?g(s,(function(t){return JSON.stringify(t)}),{capacity:u}):s}),[o,u]),h=a((function(){return o?g(y,(function(t){return JSON.stringify(t.map((function(t){return t.id||JSON.stringify(t)})))}),{capacity:u}):y}),[o,u]),m=a((function(){return o?g(d,(function(t){return JSON.stringify(t)}),{capacity:u}):d}),[o,u]),b=a((function(){return o?g(v,(function(t,n){return"".concat(t.join(","),"-").concat(JSON.stringify(n))}),{capacity:u}):v}),[o,u]);return{simplify:i((function(t,n){return l(t,n||e)}),[l,e]),flatten:i((function(t){return f(t)}),[f]),merge:i((function(t){return h(t)}),[h]),area:i((function(t){return m(t)}),[m]),contains:i((function(t,n){return b(t,n)}),[b])}}var S=g((function(t,n){return h(t,n)}),(function(t,n){var e;return JSON.stringify({id:t.id||(null===(e=t.properties)||void 0===e?void 0:e.id),options:n})}),{capacity:50}),O=function(t){var e=t.data,r=t.autoOptimize,i=void 0===r||r,o=t.simplify,c=void 0===o||o,l=t.simplifyTolerance,f=void 0===l?.001:l,s=t.flatten,p=void 0===s||s,y=t.children,d=t.id,v=a((function(){if(!e)return null;if(!i)return e;var t={simplify:c,simplifyTolerance:f,flatten:p},n=d&&!e.id?u(u({},e),{id:d}):e;return S(n,t)}),[e,i,c,f,p,d]);return v?n.createElement(n.Fragment,null,y(v)):null},N=c((function(t){var e=t.polygons,r=void 0===e?[]:e,o=t.renderPolygon,a=t.autoOptimize,c=void 0===a||a,u=t.simplify,l=void 0===u||u,f=t.simplifyTolerance,s=void 0===f?.001:f,p=t.flatten,y=void 0===p||p,d=t.getPolygonId,v=void 0===d?function(t,n){var e;return t.id||(null===(e=t.properties)||void 0===e?void 0:e.id)||"polygon-".concat(n)}:d,h=t.className,m=t.style,g=w({defaultSimplifyTolerance:s});return i((function(t){if(!c)return t;var n=t;return y&&(n=g.flatten(n)),l&&(n=g.simplify(n,s)),n}),[c,y,l,s,g]),r&&0!==r.length?n.createElement("div",{className:h,style:m},r.map((function(t,e){var r=v(t,e);return n.createElement(O,{key:r,id:r,data:t,autoOptimize:c,simplify:l,simplifyTolerance:s,flatten:y},(function(t){return o(t,e)}))}))):n.createElement("div",{className:h,style:m})}));export{m as LRUCache,O as OptimizedPolygon,N as PolygonMap,d as calculateArea,s as flattenMultiPolygon,v as isPointInPolygon,g as memoize,y as mergePolygons,h as optimizeForRendering,p as simplifyPolygon,b as usePolygonData,w as usePolygonOperations};
//# sourceMappingURL=index.esm.js.map
