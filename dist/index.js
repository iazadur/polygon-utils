"use strict";var t=require("@turf/turf"),e=require("react");function n(t){var e=Object.create(null);return t&&Object.keys(t).forEach((function(n){if("default"!==n){var r=Object.getOwnPropertyDescriptor(t,n);Object.defineProperty(e,n,r.get?r:{enumerable:!0,get:function(){return t[n]}})}})),e.default=t,Object.freeze(e)}var r=n(t),i=function(){return i=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++)for(var i in e=arguments[n])Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t},i.apply(this,arguments)};function o(t,e,n,r){return new(n||(n=Promise))((function(i,o){function a(t){try{c(r.next(t))}catch(t){o(t)}}function u(t){try{c(r.throw(t))}catch(t){o(t)}}function c(t){var e;t.done?i(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(a,u)}c((r=r.apply(t,e||[])).next())}))}function a(t,e){var n,r,i,o={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]},a=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return a.next=u(0),a.throw=u(1),a.return=u(2),"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function u(u){return function(c){return function(u){if(n)throw new TypeError("Generator is already executing.");for(;a&&(a=0,u[0]&&(o=0)),o;)try{if(n=1,r&&(i=2&u[0]?r.return:u[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,u[1])).done)return i;switch(r=0,i&&(u=[2&u[0],i.value]),u[0]){case 0:case 1:i=u;break;case 4:return o.label++,{value:u[1],done:!1};case 5:o.label++,r=u[1],u=[0];continue;case 7:u=o.ops.pop(),o.trys.pop();continue;default:if(!(i=o.trys,(i=i.length>0&&i[i.length-1])||6!==u[0]&&2!==u[0])){o=0;continue}if(3===u[0]&&(!i||u[1]>i[0]&&u[1]<i[3])){o.label=u[1];break}if(6===u[0]&&o.label<i[1]){o.label=i[1],i=u;break}if(i&&o.label<i[2]){o.label=i[2],o.ops.push(u);break}i[2]&&o.ops.pop(),o.trys.pop();continue}u=e.call(t,o)}catch(t){u=[6,t],r=0}finally{n=i=0}if(5&u[0])throw u[1];return{value:u[0]?u[1]:void 0,done:!0}}([u,c])}}}"function"==typeof SuppressedError&&SuppressedError;var u=function(t){var e;return t?"MultiPolygon"===t.type?{type:"Polygon",coordinates:t.coordinates.flat(1)}:"Feature"===t.type&&"MultiPolygon"===(null===(e=t.geometry)||void 0===e?void 0:e.type)?i(i({},t),{geometry:{type:"Polygon",coordinates:t.geometry.coordinates.flat(1)}}):t:null},c=function(t,e){return void 0===e&&(e=.001),t?r.simplify(t,{tolerance:e,highQuality:!1}):null},l=function(t){if(!t||0===t.length)return null;if(1===t.length)return t[0];try{for(var e=t.map((function(t){return"Feature"===t.type?t:r.feature(t)})),n=(r.featureCollection(e),e[0]),i=1;i<e.length;i++)n=r.union(n,e[i]);return n}catch(e){return console.error("Error merging polygons:",e),t[0]}},s=function(t){return t?r.area(t):0},f=function(t,e){if(!t||!e)return!1;var n=r.point(t);return r.booleanPointInPolygon(n,e)},p=function(t,e){if(void 0===e&&(e={}),!t)return null;var n=e.simplify,r=void 0===n||n,i=e.simplifyTolerance,o=void 0===i?.001:i,a=e.flatten,l=t;return(void 0===a||a)&&(l=u(l)),r&&(l=c(l,o)),l},y=function(){function t(t){void 0===t&&(t=100),this.capacity=t,this.cache=new Map}return t.prototype.get=function(t){if(this.cache.has(t)){var e=this.cache.get(t);return this.cache.delete(t),this.cache.set(t,e),e}},t.prototype.set=function(t,e){if(this.cache.has(t))this.cache.delete(t);else if(this.cache.size>=this.capacity){var n=this.cache.keys().next().value;void 0!==n&&this.cache.delete(n)}this.cache.set(t,e)},t.prototype.delete=function(t){return this.cache.delete(t)},t.prototype.clear=function(){this.cache.clear()},t.prototype.size=function(){return this.cache.size},t.prototype.keys=function(){return Array.from(this.cache.keys())},t}();function d(t,e,n){void 0===e&&(e=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return JSON.stringify(t)}),void 0===n&&(n={});var r=new y(n.capacity||100);return function(){for(var n=[],i=0;i<arguments.length;i++)n[i]=arguments[i];var o=e.apply(void 0,n),a=r.get(o);if(void 0!==a)return a;var u=t.apply(void 0,n);return r.set(o,u),u}}function v(t){void 0===t&&(t={});var n=t.defaultSimplifyTolerance,r=void 0===n?.001:n,i=t.useMemoization,o=void 0===i||i,a=t.cacheSize,p=void 0===a?50:a,y=e.useMemo((function(){return o?d(c,(function(t,e){return"".concat(JSON.stringify(t),"-").concat(e)}),{capacity:p}):c}),[o,p]),v=e.useMemo((function(){return o?d(u,(function(t){return JSON.stringify(t)}),{capacity:p}):u}),[o,p]),h=e.useMemo((function(){return o?d(l,(function(t){return JSON.stringify(t.map((function(t){return t.id||JSON.stringify(t)})))}),{capacity:p}):l}),[o,p]),g=e.useMemo((function(){return o?d(s,(function(t){return JSON.stringify(t)}),{capacity:p}):s}),[o,p]),m=e.useMemo((function(){return o?d(f,(function(t,e){return"".concat(t.join(","),"-").concat(JSON.stringify(e))}),{capacity:p}):f}),[o,p]);return{simplify:e.useCallback((function(t,e){return y(t,e||r)}),[y,r]),flatten:e.useCallback((function(t){return v(t)}),[v]),merge:e.useCallback((function(t){return h(t)}),[h]),area:e.useCallback((function(t){return g(t)}),[g]),contains:e.useCallback((function(t,e){return m(t,e)}),[m])}}var h=d((function(t,e){return p(t,e)}),(function(t,e){var n;return JSON.stringify({id:t.id||(null===(n=t.properties)||void 0===n?void 0:n.id),options:e})}),{capacity:50}),g=function(t){var n=t.data,r=t.autoOptimize,o=void 0===r||r,a=t.simplify,u=void 0===a||a,c=t.simplifyTolerance,l=void 0===c?.001:c,s=t.flatten,f=void 0===s||s,p=t.children,y=t.id,d=e.useMemo((function(){if(!n)return null;if(!o)return n;var t={simplify:u,simplifyTolerance:l,flatten:f},e=y&&!n.id?i(i({},n),{id:y}):n;return h(e,t)}),[n,o,u,l,f,y]);return d?e.createElement(e.Fragment,null,p(d)):null},m=e.memo((function(t){var n=t.polygons,r=void 0===n?[]:n,i=t.renderPolygon,o=t.autoOptimize,a=void 0===o||o,u=t.simplify,c=void 0===u||u,l=t.simplifyTolerance,s=void 0===l?.001:l,f=t.flatten,p=void 0===f||f,y=t.getPolygonId,d=void 0===y?function(t,e){var n;return t.id||(null===(n=t.properties)||void 0===n?void 0:n.id)||"polygon-".concat(e)}:y,h=t.className,m=t.style,b=v({defaultSimplifyTolerance:s});return e.useCallback((function(t){if(!a)return t;var e=t;return p&&(e=b.flatten(e)),c&&(e=b.simplify(e,s)),e}),[a,p,c,s,b]),r&&0!==r.length?e.createElement("div",{className:h,style:m},r.map((function(t,n){var r=d(t,n);return e.createElement(g,{key:r,id:r,data:t,autoOptimize:a,simplify:c,simplifyTolerance:s,flatten:p},(function(t){return i(t,n)}))}))):e.createElement("div",{className:h,style:m})}));exports.LRUCache=y,exports.OptimizedPolygon=g,exports.PolygonMap=m,exports.calculateArea=s,exports.flattenMultiPolygon=u,exports.isPointInPolygon=f,exports.memoize=d,exports.mergePolygons=l,exports.optimizeForRendering=p,exports.simplifyPolygon=c,exports.usePolygonData=function(t,n){var r=this;void 0===n&&(n={});var i=n.flatten,u=void 0===i||i,c=n.simplify,l=void 0===c||c,s=n.simplifyTolerance,f=void 0===s?.001:s,y=n.pollingInterval,v=void 0===y?0:y,h=n.autoOptimize,g=void 0===h||h,m=e.useState(null),b=m[0],O=m[1],P=e.useState(!0),S=P[0],w=P[1],k=e.useState(null),x=k[0],M=k[1],z=e.useRef(d((function(t){return p(t,{simplify:l,simplifyTolerance:f,flatten:u})}),(function(t){return JSON.stringify({id:t.id||Math.random().toString(36).substring(2,9),lastModified:t.lastModified||Date.now()})}),{capacity:20})).current,E=e.useCallback((function(){return o(r,void 0,void 0,(function(){var e,n,r,i;return a(this,(function(o){switch(o.label){case 0:return o.trys.push([0,3,,4]),w(!0),M(null),[4,fetch(t)];case 1:if(!(e=o.sent()).ok)throw new Error("HTTP error! Status: ".concat(e.status));return[4,e.json()];case 2:return n=o.sent(),r=g?z(n):n,O(r),w(!1),[3,4];case 3:return i=o.sent(),M(i instanceof Error?i:new Error(String(i))),w(!1),[3,4];case 4:return[2]}}))}))}),[t,g,z]);e.useEffect((function(){var t;return E(),v>0&&(t=setInterval(E,v)),function(){t&&clearInterval(t)}}),[E,v]);var N=e.useCallback((function(){return o(r,void 0,void 0,(function(){return a(this,(function(t){switch(t.label){case 0:return[4,E()];case 1:return t.sent(),[2]}}))}))}),[E]);return{data:b,loading:S,error:x,refresh:N}},exports.usePolygonOperations=v;
//# sourceMappingURL=index.js.map
